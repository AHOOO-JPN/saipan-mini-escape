
<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Saipan Mini Escape</title>
<style>
  :root{
    --bg0:#06101f;
    --bg1:#0b2540;
    --bg2:#0aa6a6;
    --sand:#f6e7c3;
    --panel: rgba(255,255,255,.08);
    --line: rgba(255,255,255,.14);
    --text:#f3f7ff;
    --muted: rgba(243,247,255,.72);
    --accent:#7cf7c4;
    --danger:#ff6b6b;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    color:var(--text);
    background: radial-gradient(900px 520px at 15% 0%, rgba(124,247,196,.16), transparent 55%),
                radial-gradient(900px 520px at 85% 10%, rgba(120,160,255,.18), transparent 55%),
                linear-gradient(180deg, var(--bg0), var(--bg1) 45%, rgba(10,166,166,.18));
    min-height:100vh;
  }
  .wrap{ max-width:860px; margin:0 auto; padding:18px; }
  .card{
    border:1px solid var(--line);
    background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border-radius:16px;
    padding:16px;
    backdrop-filter: blur(6px);
  }
  h1{ margin:0 0 6px; font-size:20px; letter-spacing:.3px; }
  .sub{ margin:0 0 14px; color:var(--muted); font-size:13px; line-height:1.55; }

  .grid{ display:grid; grid-template-columns: 1.25fr .75fr; gap:12px; }
  @media (max-width:760px){ .grid{ grid-template-columns:1fr; } }

  .panel{
    border:1px solid var(--line);
    background: rgba(10,18,36,.55);
    border-radius:14px;
    padding:12px;
    overflow:hidden;
  }

  /* Scene */
  .scene{
    position:relative;
    border-radius:12px;
    height:330px;
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
    background:
      radial-gradient(900px 240px at 50% 10%, rgba(255,190,120,.22), transparent 60%),
      linear-gradient(180deg, rgba(5,20,45,.20), rgba(0,0,0,.30)),
      linear-gradient(180deg, rgba(10,166,166,.18), rgba(6,16,31,.0) 65%),
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  }
  .scene::before{
    content:"";
    position:absolute; inset:0;
    background:
      linear-gradient(180deg, rgba(0,0,0,.0) 55%, rgba(246,231,195,.18) 55%),
      radial-gradient(800px 200px at 50% 72%, rgba(246,231,195,.18), transparent 70%);
    opacity:.95;
  }
  .badge{
    position:absolute; top:12px; left:12px;
    padding:8px 10px;
    border:1px solid var(--line);
    background: rgba(0,0,0,.22);
    border-radius:999px;
    font-size:12px;
    color: var(--muted);
  }

  .hotspot{
    position:absolute;
    border:1px dashed rgba(255,255,255,.22);
    background: rgba(255,255,255,.06);
    border-radius:12px;
    padding:8px 10px;
    font-size:12px;
    cursor:pointer;
    user-select:none;
    transition: transform .08s ease, background .2s ease;
  }
  .hotspot:hover{ background: rgba(255,255,255,.10); transform: translateY(-1px); }
  .hotspot small{ display:block; color:var(--muted); margin-top:2px; }

  .toast{ margin-top:10px; min-height:20px; color:var(--muted); font-size:13px; line-height:1.55;}
  .toast.good{ color: var(--accent); }
  .toast.bad{ color: var(--danger); }

  .actions{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
  button{
    border:1px solid var(--line);
    background: rgba(255,255,255,.06);
    color:var(--text);
    padding:9px 10px;
    border-radius:10px;
    cursor:pointer;
    font-weight:650;
    font-size:13px;
  }
  button:hover{ background: rgba(255,255,255,.10); }
  button.primary{ border-color: rgba(124,247,196,.55); }
  button.danger{ border-color: rgba(255,107,107,.55); }

  .kv{
    display:flex; justify-content:space-between; align-items:center; gap:10px;
    padding:10px 10px;
    border:1px dashed rgba(255,255,255,.18);
    border-radius:12px;
  }
  .kv span{ color:var(--muted); font-size:12px; }
  .inv{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
  .tag{
    display:inline-flex; align-items:center; gap:6px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.04);
    padding:6px 8px; border-radius:999px; font-size:12px;
  }
  .tag b{ color: var(--accent); }

  .tiny{ color:var(--muted); font-size:12px; line-height:1.55; }
  .log{ margin-top:8px; line-height:1.6; }

  /* Kingfisher */
  .birds{
    display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;
  }
  .bird{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.05);
    border-radius:12px;
    padding:10px;
    cursor:pointer;
    transition: transform .08s ease, background .2s ease;
    text-align:center;
  }
  .bird:hover{ transform: translateY(-1px); background: rgba(255,255,255,.09); }
  .bird .name{ font-weight:750; margin-top:6px; font-size:12px; }
  .bird .sig{ font-size:18px; margin-top:4px; }
  .bird .hint{ font-size:11px; color:var(--muted); margin-top:6px; }

  .codeRow{ display:flex; gap:8px; margin-top:10px; }
  input{
    flex:1;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.26);
    color:var(--text);
    padding:10px 10px;
    border-radius:10px;
    outline:none;
  }

  .footer{
    margin-top:12px;
    display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
  }
  .progress{
    height:10px; flex:1; min-width:220px;
    background: rgba(255,255,255,.07);
    border:1px solid rgba(255,255,255,.14);
    border-radius:999px; overflow:hidden;
  }
  .bar{
    height:100%;
    width:0%;
    background: linear-gradient(90deg, rgba(124,247,196,.95), rgba(120,160,255,.95));
  }

  a.cta{
    display:inline-flex; align-items:center; justify-content:center;
    text-decoration:none;
    border:1px solid rgba(124,247,196,.55);
    background: rgba(124,247,196,.12);
    color: var(--text);
    padding:10px 12px;
    border-radius:12px;
    font-weight:800;
    gap:8px;
  }
  a.cta:hover{ background: rgba(124,247,196,.18); }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 id="title">Saipan Mini Escapeï¼šãƒ“ãƒ¼ãƒã¨3ç¾½ã®ã‚­ãƒ³ã‚°ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼</h1>
    <p class="sub" id="subtitle">
      å¤•æš®ã‚Œã®ãƒ“ãƒ¼ãƒã€‚æ³¢éŸ³ã®ä¸­ã€3ç¾½ã®ã‚­ãƒ³ã‚°ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãŒåŒã˜æã«ä¸¦ã‚“ã§ã„ã‚‹ã€‚<br>
      ã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€ã®é †ã«â€œåˆå›³â€ã‚’èª­ã‚ã°ã€å¸°ã‚Šé“ãŒé–‹ãã‚‰ã—ã„ã€‚
    </p>

    <div class="grid">
      <!-- Left: Scene / Main -->
      <div class="panel">
        <div class="scene" id="scene">
          <div class="badge" id="sceneBadge">Scene 1/3ï¼šã‚µã‚¤ãƒ‘ãƒ³ã®ãƒ“ãƒ¼ãƒ</div>

          <!-- hotspots (scene 1) -->
          <div class="hotspot" id="hsBottle" style="left:14px; bottom:24px;">
            æ¼‚æµç“¶
            <small>ãƒ¡ãƒ¢ãŒå…¥ã£ã¦ãã†</small>
          </div>
          <div class="hotspot" id="hsShell" style="right:14px; bottom:22px;">
            è²æ®»
            <small>å…‰ã£ã¦ã‚‹â€¦ï¼Ÿ</small>
          </div>
          <div class="hotspot" id="hsBoard" style="left:22px; top:62px;">
            æœ¨ã®çœ‹æ¿
            <small>ä½•ã‹æ›¸ã„ã¦ã‚ã‚‹</small>
          </div>

          <!-- scene 2 birds -->
          <div id="birdsWrap" style="position:absolute; inset:52px 12px 12px 12px; display:none;">
            <div class="birds">
              <div class="bird" data-bird="sunset">
                <div style="font-size:34px;">ğŸ¦</div>
                <div class="name">Bird 1</div>
                <div class="sig">ğŸŒ…</div>
                <div class="hint">å¤•æ—¥ã‚’åˆå›³ã«ã™ã‚‹</div>
              </div>
              <div class="bird" data-bird="wave">
                <div style="font-size:34px;">ğŸ¦</div>
                <div class="name">Bird 2</div>
                <div class="sig">ğŸŒŠ</div>
                <div class="hint">æ³¢ã‚’åˆå›³ã«ã™ã‚‹</div>
              </div>
              <div class="bird" data-bird="shell">
                <div style="font-size:34px;">ğŸ¦</div>
                <div class="name">Bird 3</div>
                <div class="sig">ğŸš</div>
                <div class="hint">è²ã‚’åˆå›³ã«ã™ã‚‹</div>
              </div>
            </div>

            <div class="tiny" style="margin-top:10px;">
              3ç¾½ã¯â€œè¨˜å·â€ã§è©±ã—ã¦ã„ã‚‹ã€‚ã¾ãšã¯ãƒ“ãƒ¼ãƒã§ã€Œã‚µãƒ³ã‚´ã€ã®æ‰‹ãŒã‹ã‚Šã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚
            </div>
          </div>

          <!-- scene 3 door -->
          <div id="doorWrap" style="position:absolute; inset:52px 12px 12px 12px; display:none;">
            <div class="tiny">Scene 3/3ï¼šå¸°ã‚Šé“ã®ã‚²ãƒ¼ãƒˆï¼ˆ4æ¡ï¼‰</div>
            <div class="codeRow">
              <input id="codeInput" inputmode="numeric" placeholder="4æ¡ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼š3012ï¼‰" />
              <button class="primary" id="codeBtn">é–‹ã‘ã‚‹</button>
            </div>
            <div class="tiny" style="margin-top:8px;">
              ãƒ’ãƒ³ãƒˆï¼šçœ‹æ¿ï¼ˆã‚µãƒ³ã‚´ï¼‰ï¼‹3ç¾½ï¼ˆå¤•æ—¥ãƒ»æ³¢ãƒ»è²ï¼‰ï¼ã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€
            </div>
          </div>
        </div>

        <div class="toast" id="toast"></div>

        <div class="actions">
          <button id="btnGoBeach">ãƒ“ãƒ¼ãƒã¸</button>
          <button id="btnGoBirds">3ç¾½ã®æã¸</button>
          <button id="btnGoGate">ã‚²ãƒ¼ãƒˆã¸</button>
          <button id="btnHint">ãƒ’ãƒ³ãƒˆ</button>
          <button class="danger" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div class="footer">
          <div class="progress" aria-label="é€²è¡Œåº¦"><div class="bar" id="bar"></div></div>
          <div class="tiny" id="status">é€²è¡Œåº¦: 0%</div>
        </div>
      </div>

      <!-- Right: Inventory / Log -->
      <div class="panel">
        <div class="kv">
          <div><strong>æ‰€æŒå“</strong></div>
          <div><span id="invCount">0</span> / 3</div>
        </div>
        <div class="inv" id="inv"></div>

        <div style="margin-top:12px" class="kv">
          <div><strong>ãƒ¡ãƒ¢</strong></div>
          <div><span>è¦³å¯Ÿãƒ­ã‚°</span></div>
        </div>
        <div class="tiny log" id="log"></div>

        <div style="margin-top:14px;">
          <div class="tiny">ã‚¯ãƒªã‚¢å¾Œã®å°ç·šï¼ˆä»»æ„ï¼‰</div>
          <a class="cta" id="cta" href="#" target="_blank" rel="noopener">â–¶ æ—…ã®ç›¸è«‡ã‚’ã™ã‚‹</a>
          <div class="tiny" style="margin-top:8px;">
            â€»CTAã¯ã“ã®HTMLä¸Šéƒ¨ã®è¨­å®šã§å¤‰æ›´ã§ãã¾ã™ã€‚
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ====== ã‹ã‚“ãŸã‚“è¨­å®šï¼ˆã“ã“ã ã‘å¤‰ãˆã‚Œã°OKï¼‰ ======
  const CONFIG = {
    title: "Saipan Mini Escapeï¼šãƒ“ãƒ¼ãƒã¨3ç¾½ã®ã‚­ãƒ³ã‚°ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼",
    subtitle: "å¤•æš®ã‚Œã®ãƒ“ãƒ¼ãƒã€‚æ³¢éŸ³ã®ä¸­ã€3ç¾½ã®ã‚­ãƒ³ã‚°ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãŒåŒã˜æã«ä¸¦ã‚“ã§ã„ã‚‹ã€‚\\nã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€ã®é †ã«â€œåˆå›³â€ã‚’èª­ã‚ã°ã€å¸°ã‚Šé“ãŒé–‹ãã‚‰ã—ã„ã€‚",
    ctaLabel: "â–¶ ã‚µã‚¤ãƒ‘ãƒ³ã®ç›¸è«‡ã‚’ã™ã‚‹",
    ctaUrl: "https://example.com/",   // â†ã‚ãªãŸã®å•ã„åˆã‚ã›/äºˆç´„/LPã«å¤‰æ›´
    // ãƒ“ãƒ¼ãƒå†™çœŸã‚’ä½¿ã„ãŸã„å ´åˆï¼šè‡ªåˆ†ã®å†™çœŸURLï¼ˆhttpsï¼‰ã‚’å…¥ã‚Œã‚‹ï¼ˆè‘—ä½œæ¨©OKãªã‚‚ã®ã ã‘ï¼‰
    bgImageUrl: ""
  };

  // ====== State ======
  const state = {
    scene: 0, // 0 beach, 1 birds, 2 gate
    inv: new Set(),
    flags: {
      readBottle:false,
      gotShell:false,
      sawCoral:false,
      talkedBirds: new Set()
    },
    log: []
  };

  const $ = (id) => document.getElementById(id);

  // ====== UI helpers ======
  function toast(msg, type=""){
    const el = $("toast");
    el.textContent = msg;
    el.className = "toast" + (type ? " " + type : "");
  }
  function addLog(msg){
    state.log.unshift("ãƒ»" + msg);
    state.log = state.log.slice(0, 7);
    $("log").innerHTML = state.log.map(escapeHtml).join("<br>");
  }
  function escapeHtml(s){
    return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }

  function give(item){
    state.inv.add(item);
    renderInv();
  }
  function has(item){ return state.inv.has(item); }

  function progress(){
    // 3 items: NOTE, SHELL, CORAL
    const count = ["NOTE","SHELL","CORAL"].filter(x => has(x)).length;
    return Math.round((count/3)*100);
  }
  function renderInv(){
    const inv = $("inv");
    inv.innerHTML = "";

    const meta = {
      NOTE: {name:"ç“¶ã®ãƒ¡ãƒ¢", icon:"ğŸ“œ"},
      SHELL:{name:"å…‰ã‚‹è²æ®»", icon:"ğŸš"},
      CORAL:{name:"ã‚µãƒ³ã‚´ã®åˆå›³", icon:"ğŸª¸"}
    };

    const items = Array.from(state.inv);
    if(items.length === 0){
      inv.innerHTML = `<span class="tiny">ï¼ˆæ‰‹ã¶ã‚‰ã€‚æµ·é¢¨ã ã‘æŒã£ã¦ã‚‹ï¼‰</span>`;
    } else {
      for(const it of items){
        const t = document.createElement("div");
        t.className = "tag";
        t.innerHTML = `<b>${meta[it]?.icon ?? "â—"}</b> ${meta[it]?.name ?? it}`;
        inv.appendChild(t);
      }
    }
    $("invCount").textContent = items.length;
    $("bar").style.width = progress() + "%";
    $("status").textContent = "é€²è¡Œåº¦: " + progress() + "%";
  }

  function setScene(n){
    state.scene = n;
    $("birdsWrap").style.display = (n === 1) ? "block" : "none";
    $("doorWrap").style.display  = (n === 2) ? "block" : "none";

    // hotspots are only for beach scene
    const hs = [$("hsBottle"), $("hsShell"), $("hsBoard")];
    hs.forEach(x => x.style.display = (n === 0) ? "block" : "none");

    const badge = $("sceneBadge");
    if(n === 0) badge.textContent = "Scene 1/3ï¼šã‚µã‚¤ãƒ‘ãƒ³ã®ãƒ“ãƒ¼ãƒ";
    if(n === 1) badge.textContent = "Scene 2/3ï¼š3ç¾½ã®ã‚­ãƒ³ã‚°ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼";
    if(n === 2) badge.textContent = "Scene 3/3ï¼šå¸°ã‚Šé“ã®ã‚²ãƒ¼ãƒˆ";
  }

  // ====== Game logic ======
  function onBottle(){
    if(state.flags.readBottle){
      toast("æ¼‚æµç“¶ã¯ç©ºã€‚æ³¢ã«è¿”ã™ã®ãŒç¤¼å„€ã€‚", "");
      return;
    }
    state.flags.readBottle = true;
    give("NOTE");
    addLog("æ¼‚æµç“¶ã®ãƒ¡ãƒ¢ï¼šã€Œåˆå›³ã¯ â€œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²â€ã€‚4æ¡ã¯â€œè‰²ã®ç•ªå·â€ã€‚ã€");
    toast("ãƒ¡ãƒ¢ã‚’å…¥æ‰‹ï¼ã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€â€¦é †ç•ªãŒå¤§äº‹ã€‚", "good");
  }

  function onShell(){
    if(state.flags.gotShell){
      toast("ã‚‚ã†æŒã£ã¦ã‚‹ï¼ˆè²æ®»ã¯å¢—ãˆã‚‹ãŒè·ç‰©ã‚‚å¢—ãˆã‚‹ï¼‰ã€‚", "");
      return;
    }
    state.flags.gotShell = true;
    give("SHELL");
    addLog("ç ‚ã®ä¸­ã‹ã‚‰å…‰ã‚‹è²æ®»ã€‚è£ã«å°ã•ãã€Œ2ã€ã€‚");
    toast("å…‰ã‚‹è²æ®»ã‚’å…¥æ‰‹ï¼è£ã«ã€Œ2ã€ã€‚", "good");
  }

  function onBoard(){
    if(state.flags.sawCoral){
      toast("çœ‹æ¿ï¼šã€ğŸª¸=3 / ğŸŒ…=0 / ğŸŒŠ=1 / ğŸš=2ã€", "");
      return;
    }
    state.flags.sawCoral = true;
    give("CORAL");
    addLog("æœ¨ã®çœ‹æ¿ï¼šã€ğŸª¸=3 / ğŸŒ…=0 / ğŸŒŠ=1 / ğŸš=2ã€ã¨åˆ»ã¾ã‚Œã¦ã„ã‚‹ã€‚");
    toast("çœ‹æ¿ã‚’èª­ã‚“ã ï¼ã€ğŸª¸=3 / ğŸŒ…=0 / ğŸŒŠ=1 / ğŸš=2ã€", "good");
  }

  function onBirdClick(which){
    // require at least read board (coral mapping) to make sense
    if(!state.flags.sawCoral){
      toast("3ç¾½ã¯ä½•ã‹è¨€ã£ã¦ã‚‹â€¦ãŒã€ç¿»è¨³è¾æ›¸ï¼ˆçœ‹æ¿ï¼‰ãŒå¿…è¦ãã†ã€‚", "bad");
      addLog("3ç¾½ã¯è¨˜å·ã§è©±ã—ã¦ã„ã‚‹ã€‚ã¾ãšçœ‹æ¿ã‚’èª­ã‚€ã¹ãã€‚");
      return;
    }
    state.flags.talkedBirds.add(which);

    const map = { sunset:"ğŸŒ…=0", wave:"ğŸŒŠ=1", shell:"ğŸš=2" };
    const add = { sunset:"å¤•æ—¥(0)", wave:"æ³¢(1)", shell:"è²(2)" };

    addLog(`ã‚­ãƒ³ã‚°ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãŒåˆå›³ï¼š${add[which]}ã€‚`);
    toast(`åˆå›³ã‚’ç¢ºèªï¼š${map[which]}ã€‚é †ç•ªã¯ã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€`, "good");
  }

  // final code derived from board mapping and fixed order CORAL->SUNSET->WAVE->SHELL = 3 0 1 2
  const SAFE_CODE = "3012";

  function tryOpen(){
    const raw = $("codeInput").value || "";
    const digits = (raw.match(/\d/g) || []).join("").slice(0,4);
    $("codeInput").value = digits;

    if(digits.length < 4){
      toast("4æ¡ãã‚ãˆã¦ã­ï¼ˆæµ·ã¯é€ƒã’ãªã„ã€ã§ã‚‚ãƒãƒ£ãƒ³ã‚¹ã¯é€ƒã’ã‚‹ï¼‰ã€‚", "bad");
      return;
    }
    if(!state.flags.sawCoral){
      toast("ã¾ãšçœ‹æ¿ï¼ˆè¨˜å·â†’æ•°å­—ï¼‰ã‚’ç¢ºèªã—ã‚ˆã†ã€‚", "bad");
      return;
    }
    if(state.flags.talkedBirds.size < 3){
      toast("3ç¾½ã®åˆå›³ï¼ˆå¤•æ—¥ãƒ»æ³¢ãƒ»è²ï¼‰ã‚’å…¨éƒ¨ç¢ºèªã—ã‚ˆã†ã€‚", "bad");
      return;
    }
    if(digits !== SAFE_CODE){
      addLog(`ã‚²ãƒ¼ãƒˆã«ã€Œ${digits}ã€â†’åå¿œãªã—ã€‚`);
      toast("é•ã†ã¿ãŸã„ã€‚é †ç•ªãƒ’ãƒ³ãƒˆï¼šã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€", "bad");
      return;
    }

    addLog("ã‚²ãƒ¼ãƒˆãŒé–‹ã„ãŸã€‚ç›®ã®å‰ã«â€œã‚µã‚¤ãƒ‘ãƒ³ã®ç©ºâ€ã¿ãŸã„ãªé“ã€‚");
    toast("è„±å‡ºæˆåŠŸï¼ğŸ‰ 3ç¾½ã¯å¾—æ„ã’ã«é£›ã³å»ã£ãŸã€‚", "good");

    // Make buttons celebratory
    $("codeBtn").textContent = "é–‹ã„ãŸï¼";
    $("codeBtn").disabled = true;
  }

  function hint(){
    if(state.scene === 0){
      if(!state.flags.readBottle) return toast("ãƒ’ãƒ³ãƒˆï¼šæ¼‚æµç“¶ã®ãƒ¡ãƒ¢ãŒâ€œé †ç•ªâ€ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã€‚", "");
      if(!state.flags.sawCoral)   return toast("ãƒ’ãƒ³ãƒˆï¼šæœ¨ã®çœ‹æ¿ãŒã€Œè¨˜å·â†’æ•°å­—ã€ã®è¾æ›¸ã€‚", "");
      if(!state.flags.gotShell)   return toast("ãƒ’ãƒ³ãƒˆï¼šå…‰ã‚‹è²æ®»ã¯ç ‚ã®ä¸Šï¼ˆå³ä¸‹ï¼‰ã«ã€‚", "");
      return toast("ãƒ’ãƒ³ãƒˆï¼šæ¬¡ã¯ã€Œ3ç¾½ã®æã€ã¸ã€‚", "");
    }
    if(state.scene === 1){
      if(!state.flags.sawCoral) return toast("ãƒ’ãƒ³ãƒˆï¼šå…ˆã«ãƒ“ãƒ¼ãƒã®çœ‹æ¿ã¸æˆ»ã£ã¦è¾æ›¸ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã€‚", "");
      if(state.flags.talkedBirds.size < 3) return toast("ãƒ’ãƒ³ãƒˆï¼š3ç¾½ã‚’å…¨éƒ¨ã‚¿ãƒƒãƒ—ï¼ˆå¤•æ—¥ãƒ»æ³¢ãƒ»è²ï¼‰ã€‚", "");
      return toast("ãƒ’ãƒ³ãƒˆï¼šæœ€å¾Œã¯ã‚²ãƒ¼ãƒˆã§4æ¡å…¥åŠ›ã€‚ã€Œã‚µãƒ³ã‚´â†’å¤•æ—¥â†’æ³¢â†’è²ã€ã€‚", "");
    }
    if(state.scene === 2){
      return toast("ãƒ’ãƒ³ãƒˆï¼šçœ‹æ¿ã®è¾æ›¸ã©ãŠã‚Šã«ã€ŒğŸª¸ğŸŒ…ğŸŒŠğŸšã€â†’ã€Œ3012ã€ã€‚", "");
    }
  }

  function reset(){
    state.scene = 0;
    state.inv = new Set();
    state.flags = { readBottle:false, gotShell:false, sawCoral:false, talkedBirds:new Set() };
    state.log = [];
    $("codeInput").value = "";
    $("codeBtn").textContent = "é–‹ã‘ã‚‹";
    $("codeBtn").disabled = false;
    renderInv();
    addLog("ãƒªã‚»ãƒƒãƒˆã€‚æ³¢ã¯ã„ã¤ã‚‚ã‚¼ãƒ­ã‹ã‚‰ã€‚");
    toast("æœ€åˆã‹ã‚‰ã©ã†ãã€‚", "");
    setScene(0);
  }

  // ====== Init ======
  $("title").textContent = CONFIG.title;
  $("subtitle").textContent = CONFIG.subtitle;
  const cta = $("cta");
  cta.textContent = CONFIG.ctaLabel;
  cta.href = CONFIG.ctaUrl;

  // optional background photo (use your own/licensed)
  if(CONFIG.bgImageUrl){
    $("scene").style.background =
      `linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.35)),
       url("${CONFIG.bgImageUrl}") center/cover no-repeat`;
  }

  // Wire
  $("hsBottle").addEventListener("click", onBottle);
  $("hsShell").addEventListener("click", onShell);
  $("hsBoard").addEventListener("click", onBoard);

  document.querySelectorAll(".bird").forEach(el => {
    el.addEventListener("click", () => onBirdClick(el.dataset.bird));
  });

  $("btnGoBeach").addEventListener("click", () => setScene(0));
  $("btnGoBirds").addEventListener("click", () => setScene(1));
  $("btnGoGate").addEventListener("click",  () => setScene(2));
  $("btnHint").addEventListener("click", hint);
  $("btnReset").addEventListener("click", reset);

  $("codeBtn").addEventListener("click", tryOpen);
  $("codeInput").addEventListener("keydown", (e) => { if(e.key === "Enter") tryOpen(); });

  renderInv();
  addLog("é–‹å§‹ã€‚ãƒ“ãƒ¼ãƒã®è¦³å¯Ÿã‹ã‚‰ã€‚");
  toast("ã¾ãšã¯ãƒ“ãƒ¼ãƒã§ã€Œæ¼‚æµç“¶ã€ã€Œæœ¨ã®çœ‹æ¿ã€ã€Œè²æ®»ã€ã‚’èª¿ã¹ã‚ˆã†ã€‚", "");
  setScene(0);
})();
</script>
</body>
</html>